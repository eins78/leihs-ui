<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
  <meta charset="utf-8">
  <title>leihs login</title>
  <link rel="stylesheet" href="/static/bootstrap-leihs/bootstrap-leihs.css">
</head>

<body class='h-100 m-0 p-0'>
  <div class="h-100 d-flex align-items-center">



    <div class="ui-login-form text-center" style="width:100%; max-width:330px; padding:15px; margin:auto">
      <form class="form-signin" data-hook="login-form" method="post" action="/sign-in">
        <h1 class="h3 mb-3 font-weight-normal">Login</h1>
        <div data-hook="login-form-user">
          <label class="w-100 m-0">
            <span class="sr-only">Email address</span>
            <input
              name="user"
              type="text"
              required
              placeholder="Nutzername oder Email"
              autocomplete="username email"
              class="form-control"
              style="margin-bottom: -1px;">
          </label>
        </div>

        <div data-hook="login-form-password" aria-hidden="false">
          <label class="w-100 m-0">
            <span class="sr-only">Password</span>
            <input
              type="password"
              name="password"
              required
              autofocus
              placeholder="Passwort"
              autocomplete="current-password"
              class="form-control"
              style="border-top-right-radius:0; border-top-left-radius:0"
            >
          </label>
        </div>

        <button data-hook="login-form-button"
          class="btn btn-lg btn-success btn-block mt-3" type="submit">Login</button>
      </form>
      <script type="text/javascript">
        (function () {
        var REQUIRES_EXPLICIT_SUBMIT = true

        var state = { step: 0 }
        var ui = {}
        ui.form = document.querySelector('[data-hook="login-form"]')
        ui.user = ui.form.querySelector('[data-hook="login-form-user"]')
        ui.userField = ui.user.querySelector('input[type="text"]')
        ui.password = ui.form.querySelector('[data-hook="login-form-password"]')
        ui.passwordField = ui.password.querySelector('input[type="password"]')
        ui.button = ui.form.querySelector('[data-hook="login-form-button"]')

        init()

        // FIXME: dev
        window.ui = ui

        function init() {
          togglePwShown(false)
          setText(ui.button, 'Weiter')
          ui.form.addEventListener('submit', handleSubmit);
          state.step = 1
        }

        function handleSubmit(event) {
          var userVal = ui.userField.value.trim()
          var pwVal = ui.passwordField.value

          if (!userVal) {
            // just in case, should not happen bc field is 'required'
            console.log('no user val!');
            event.preventDefault()
            return false
          }

          // start step 2
          // - if has been filled by browser or pw manager in background,
          //   require at least 1 "real" submit (if configured)
          if (!pwVal || (REQUIRES_EXPLICIT_SUBMIT && state.step < 2)) {
            console.log('no pw val!');
            togglePwShown(true)
            setText(ui.button, 'Login')
            state.step = 2
            event.preventDefault()
            return false
          }
        }

        function togglePwShown(shown) {
          if (!shown) {
            addClass(ui.password, 'sr-only')
            ui.user.style = "margin-bottom: -1px;"
            ui.passwordField.removeAttribute('required')
          } else {
            removeClass(ui.password, 'sr-only')
            ui.user.style = "margin-bottom: -1px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px;"
            ui.passwordField.setAttribute('required', '')
          }
        }
        })()

        function addClass(node, cls) {
          node.className = node.className + ' ' + cls
        }
        function removeClass(node, cls) {
          var toRemove = cls.trim()
          node.className = node.className
            .split(/\s/)
            .filter(function (str) { return str !== toRemove })
            .join(' ')
        }
        function setText(node, text) {
          node.innerText = text
        }
      </script>
    </div>


  </div>


</body>

</html>
